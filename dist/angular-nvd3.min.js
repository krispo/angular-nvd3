(function(window){"use strict";var nv=window.nv;if(typeof exports!=="undefined"){nv=require("nvd3")}angular.module("nvd3",[]).directive("nvd3",["nvd3Utils",function(nvd3Utils){return{restrict:"AE",scope:{data:"=",options:"=",api:"=?",events:"=?",config:"=?",onReady:"&?"},link:function(scope,element,attrs){var defaultConfig={extended:false,visible:true,disabled:false,refreshDataOnly:true,deepWatchOptions:true,deepWatchData:true,deepWatchDataDepth:2,debounce:10,debounceImmediate:true};scope.isReady=false;scope._config=angular.extend(defaultConfig,scope.config);scope.api={refresh:function(){scope.api.updateWithOptions();scope.isReady=true},refreshWithTimeout:function(t){setTimeout(function(){scope.api.refresh()},t)},update:function(){if(scope.chart&&scope.svg){if(scope.options.chart.type==="sunburstChart"){scope.svg.datum(angular.copy(scope.data)).call(scope.chart)}else{scope.svg.datum(scope.data).call(scope.chart)}}else{scope.api.refresh()}},updateWithTimeout:function(t){setTimeout(function(){scope.api.update()},t)},updateWithOptions:function(options){if(!arguments.length){options=scope.options}else{scope.options=options;if(scope._config.deepWatchOptions&&!scope._config.disabled)return}scope.api.clearElement();if(angular.isDefined(options)===false)return;if(!scope._config.visible)return;scope.chart=nv.models[options.chart.type]();scope.chart.id=Math.random().toString(36).substr(2,15);angular.forEach(scope.chart,function(value,key){if(key[0]==="_");else if(["clearHighlights","highlightPoint","id","options","resizeHandler","state","open","close","tooltipContent"].indexOf(key)>=0);else if(key==="dispatch"){if(options.chart[key]===undefined||options.chart[key]===null){if(scope._config.extended)options.chart[key]={}}configureEvents(scope.chart[key],options.chart[key])}else if(["bars","bars1","bars2","boxplot","bullet","controls","discretebar","distX","distY","focus","interactiveLayer","legend","lines","lines1","lines2","multibar","pie","scatter","scatters1","scatters2","sparkline","stack1","stack2","sunburst","tooltip","x2Axis","xAxis","y1Axis","y2Axis","y3Axis","y4Axis","yAxis","yAxis1","yAxis2"].indexOf(key)>=0||key==="stacked"&&options.chart.type==="stackedAreaChart"){if(options.chart[key]===undefined||options.chart[key]===null){if(scope._config.extended)options.chart[key]={}}configure(scope.chart[key],options.chart[key],options.chart.type)}else if(key==="focusHeight"&&options.chart.type==="lineChart");else if(key==="focusHeight"&&options.chart.type==="lineWithFocusChart");else if((key==="xTickFormat"||key==="yTickFormat")&&options.chart.type==="lineWithFocusChart");else if(key==="tooltips"&&options.chart.type==="boxPlotChart");else if((key==="tooltipXContent"||key==="tooltipYContent")&&options.chart.type==="scatterChart");else if((key==="x"||key==="y")&&options.chart.type==="forceDirectedGraph");else if(options.chart[key]===undefined||options.chart[key]===null){if(scope._config.extended){if(key==="barColor")options.chart[key]=value()();else options.chart[key]=value()}}else scope.chart[key](options.chart[key])});scope.api.updateWithData();if(options["title"]||scope._config.extended)configureWrapper("title");if(options["subtitle"]||scope._config.extended)configureWrapper("subtitle");if(options["caption"]||scope._config.extended)configureWrapper("caption");if(options["styles"]||scope._config.extended)configureStyles();nv.addGraph(function(){if(!scope.chart)return;if(scope.chart.resizeHandler)scope.chart.resizeHandler.clear();scope.chart.resizeHandler=nv.utils.windowResize(function(){scope.chart&&scope.chart.update&&scope.chart.update()});if(options.chart.zoom!==undefined&&["scatterChart","lineChart","candlestickBarChart","cumulativeLineChart","historicalBarChart","ohlcBarChart","stackedAreaChart"].indexOf(options.chart.type)>-1){nvd3Utils.zoom(scope,options)}return scope.chart},options.chart["callback"])},updateWithData:function(data){if(!arguments.length){if(scope.options.chart.type==="sunburstChart"){data=angular.copy(scope.data)}else{data=scope.data}}else{scope.data=data;if(scope._config.deepWatchData&&!scope._config.disabled)return}if(data){d3.select(element[0]).select("svg").remove();var h,w;scope.svg=d3.select(element[0]).insert("svg",".caption");if(h=scope.options.chart.height){if(!isNaN(+h))h+="px";scope.svg.attr("height",h).style({height:h})}if(w=scope.options.chart.width){if(!isNaN(+w))w+="px";scope.svg.attr("width",w).style({width:w})}else{scope.svg.attr("width","100%").style({width:"100%"})}scope.svg.datum(data).call(scope.chart);if(scope.chart&&scope.chart.zoomRender)scope.chart.zoomRender()}},clearElement:function(){element.find(".title").remove();element.find(".subtitle").remove();element.find(".caption").remove();element.empty();if(scope.chart&&scope.chart.tooltip&&scope.chart.tooltip.id){d3.select("#"+scope.chart.tooltip.id()).remove()}if(scope.chart&&scope.chart.interactiveLayer&&scope.chart.interactiveLayer.tooltip&&scope.chart.interactiveLayer.tooltip.id){d3.select("#"+scope.chart.interactiveLayer.tooltip.id()).remove()}if(nv.graphs&&scope.chart){for(var i=nv.graphs.length-1;i>=0;i--){if(nv.graphs[i]&&nv.graphs[i].id===scope.chart.id){nv.graphs.splice(i,1)}}}if(nv.tooltip&&nv.tooltip.cleanup){nv.tooltip.cleanup()}if(scope.chart&&scope.chart.resizeHandler)scope.chart.resizeHandler.clear();scope.chart=null},getScope:function(){return scope},getElement:function(){return element}};function configure(chart,options,chartType){if(chart&&options){angular.forEach(chart,function(value,key){if(key[0]==="_");else if(key==="dispatch"){if(options[key]===undefined||options[key]===null){if(scope._config.extended)options[key]={}}configureEvents(value,options[key])}else if(key==="tooltip"){if(options[key]===undefined||options[key]===null){if(scope._config.extended)options[key]={}}configure(chart[key],options[key],chartType)}else if(key==="contentGenerator"){if(options[key])chart[key](options[key])}else if(["axis","clearHighlights","defined","highlightPoint","nvPointerEventsClass","options","rangeBand","rangeBands","scatter","open","close","node"].indexOf(key)===-1){if(options[key]===undefined||options[key]===null){if(scope._config.extended)options[key]=value()}else chart[key](options[key])}})}}function configureEvents(dispatch,options){if(dispatch&&options){angular.forEach(dispatch,function(value,key){if(options[key]===undefined||options[key]===null){if(scope._config.extended)options[key]=value.on}else dispatch.on(key+"._",options[key])})}}function configureWrapper(name){var _=nvd3Utils.deepExtend(defaultWrapper(name),scope.options[name]||{});if(scope._config.extended)scope.options[name]=_;var wrapElement=angular.element("<div></div>").html(_["html"]||"").addClass(name).addClass(_.className).removeAttr("style").css(_.css);if(!_["html"])wrapElement.text(_.text);if(_.enable){if(name==="title")element.prepend(wrapElement);else if(name==="subtitle")angular.element(element[0].querySelector(".title")).after(wrapElement);else if(name==="caption")element.append(wrapElement)}}function configureStyles(){var _=nvd3Utils.deepExtend(defaultStyles(),scope.options["styles"]||{});if(scope._config.extended)scope.options["styles"]=_;angular.forEach(_.classes,function(value,key){value?element.addClass(key):element.removeClass(key)});element.removeAttr("style").css(_.css)}function defaultWrapper(_){switch(_){case"title":return{enable:false,text:"Write Your Title",className:"h4",css:{width:scope.options.chart.width+"px",textAlign:"center"}};case"subtitle":return{enable:false,text:"Write Your Subtitle",css:{width:scope.options.chart.width+"px",textAlign:"center"}};case"caption":return{enable:false,text:"Figure 1. Write Your Caption text.",css:{width:scope.options.chart.width+"px",textAlign:"center"}}}}function defaultStyles(){return{classes:{"with-3d-shadow":true,"with-transitions":true,gallery:false},css:{}}}if(scope._config.deepWatchOptions){scope.$watch("options",nvd3Utils.debounce(function(newOptions){if(!scope._config.disabled)scope.api.refresh()},scope._config.debounce,scope._config.debounceImmediate),true)}function dataWatchFn(newData,oldData){if(newData!==oldData){if(!scope._config.disabled){scope._config.refreshDataOnly?scope.api.update():scope.api.refresh()}}}if(scope._config.deepWatchData){if(scope._config.deepWatchDataDepth===1){scope.$watchCollection("data",dataWatchFn)}else{scope.$watch("data",dataWatchFn,scope._config.deepWatchDataDepth===2)}}scope.$watch("config",function(newConfig,oldConfig){if(newConfig!==oldConfig){scope._config=angular.extend(defaultConfig,newConfig);scope.api.refresh()}},true);if(!scope._config.deepWatchOptions&&!scope._config.deepWatchData){scope.api.refresh()}angular.forEach(scope.events,function(eventHandler,event){scope.$on(event,function(e,args){return eventHandler(e,scope,args)})});element.on("$destroy",function(){scope.api.clearElement()});scope.$watch("isReady",function(isReady){if(isReady){if(scope.onReady&&typeof scope.onReady()==="function")scope.onReady()(scope,element)}})}}}]).factory("nvd3Utils",function(){return{debounce:function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}},deepExtend:function(dst){var me=this;angular.forEach(arguments,function(obj){if(obj!==dst){angular.forEach(obj,function(value,key){if(dst[key]&&dst[key].constructor&&dst[key].constructor===Object){me.deepExtend(dst[key],value)}else{dst[key]=value}})}});return dst},zoom:function(scope,options){var zoom=options.chart.zoom;var enabled=typeof zoom.enabled==="undefined"||zoom.enabled===null?true:zoom.enabled;if(!enabled)return;var xScale=scope.chart.xAxis.scale(),yScale=scope.chart.yAxis.scale(),xDomain=scope.chart.xDomain||xScale.domain,yDomain=scope.chart.yDomain||yScale.domain,x_boundary=xScale.domain().slice(),y_boundary=yScale.domain().slice(),scale=zoom.scale||1,translate=zoom.translate||[0,0],scaleExtent=zoom.scaleExtent||[1,10],useFixedDomain=zoom.useFixedDomain||false,useNiceScale=zoom.useNiceScale||false,horizontalOff=zoom.horizontalOff||false,verticalOff=zoom.verticalOff||false,unzoomEventType=zoom.unzoomEventType||"dblclick.zoom",fixDomain,d3zoom,zoomed,unzoomed,zoomend;if(useNiceScale){xScale.nice();yScale.nice()}fixDomain=function(domain,boundary){domain[0]=Math.min(Math.max(domain[0],boundary[0]),boundary[1]-boundary[1]/scaleExtent[1]);domain[1]=Math.max(boundary[0]+boundary[1]/scaleExtent[1],Math.min(domain[1],boundary[1]));return domain};zoomed=function(){if(zoom.zoomed!==undefined){var domains=zoom.zoomed(xScale.domain(),yScale.domain());if(!horizontalOff)xDomain([domains.x1,domains.x2]);if(!verticalOff)yDomain([domains.y1,domains.y2])}else{if(!horizontalOff)xDomain(useFixedDomain?fixDomain(xScale.domain(),x_boundary):xScale.domain());if(!verticalOff)yDomain(useFixedDomain?fixDomain(yScale.domain(),y_boundary):yScale.domain())}if(scope.chart)scope.chart.update()};unzoomed=function(){if(zoom.unzoomed!==undefined){var domains=zoom.unzoomed(xScale.domain(),yScale.domain());if(!horizontalOff)xDomain([domains.x1,domains.x2]);if(!verticalOff)yDomain([domains.y1,domains.y2])}else{if(!horizontalOff)xDomain(x_boundary);if(!verticalOff)yDomain(y_boundary)}d3zoom.scale(scale).translate(translate);if(scope.chart)scope.chart.update()};zoomend=function(){if(zoom.zoomend!==undefined){zoom.zoomend()}};d3zoom=d3.behavior.zoom().x(xScale).y(yScale).scaleExtent(scaleExtent).on("zoom",zoomed).on("zoomend",zoomend);if(scope.svg){scope.svg.call(d3zoom);d3zoom.scale(scale).translate(translate).event(scope.svg);if(unzoomEventType!=="none")scope.svg.on(unzoomEventType,unzoomed)}if(scope.chart)scope.chart.zoomRender=function(){d3zoom.scale(scale).translate(translate);xScale=scope.chart.xAxis.scale();yScale=scope.chart.yAxis.scale();xDomain=scope.chart.xDomain||xScale.domain;yDomain=scope.chart.yDomain||yScale.domain;x_boundary=xScale.domain().slice();y_boundary=yScale.domain().slice();d3zoom.x(xScale).y(yScale);scope.svg.call(d3zoom);if(unzoomEventType!=="none")scope.svg.on(unzoomEventType,unzoomed)}}}})})(window);